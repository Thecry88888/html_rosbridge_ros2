<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="/node_modules/roslib/importmap.js"></script>

    <script type="module">
      import * as ROSLIB from "roslib";
      // Connecting to ROS
      // -----------------
      var ros = new ROSLIB.Ros();

      // If there is an error on the backend, an 'error' emit will be emitted.
      ros.on("error", function (error) {
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("error").style.display = "inline";
        console.log(error);
      });

      // Find out exactly when we made a connection.
      ros.on("connection", function () {
        console.log("Connection made!");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("connected").style.display = "inline";
      });

      ros.on("close", function () {
        console.log("Connection closed.");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "inline";
      });

      // Create a connection to the rosbridge WebSocket server.
      ros.connect("ws://localhost:9090");

      // Calling a service
      // -----------------

      var startEndPoseClient = new ROSLIB.Service({
        ros: ros,
        name: "/set_start_end_pose",
        serviceType: "robot_interfaces/srv/StartEndPose",
      });

      var request = {
        // float32[6] startpose
        startpose: [1.0, 0.0, 0.0, 0.0, 0.0, 0.0],
        // float32[6] endpose
        endpose: [0.5, 0.5, 0.5, 0.1, 0.1, 0.1], 
      };

      startEndPoseClient.callService(request, function (result) {
        console.log(
          "Result for service call on " +
            startEndPoseClient.name +
            ": " +
            (result.success ? "成功" : "失敗"),
        );
        console.log("回傳訊息: " + result.message);
        console.log("------------------");
      });
    </script>
  </head>

  <body>
    <h1>Set Start and End Pose Client</h1>
    <p>
      Run the following commands in the terminal then refresh this page. Check
      the JavaScript console for the output.
    </p>
    <ol>
      <li><tt>ros2 launch strategy strategy.launch.py </tt></li>
      <li>
        <tt>ros2 launch rosbridge_server rosbridge_websocket_launch.xml</tt>
      </li>
    </ol>
    <div id="statusIndicator">
      <p id="connecting">Connecting to rosbridge...</p>
      <p id="connected" style="color: #00d600; display: none">Connected</p>
      <p id="error" style="color: #ff0000; display: none">
        Error in the backend!
      </p>
      <p id="closed" style="display: none">Connection closed.</p>
    </div>
  </body>
</html>
