<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="/node_modules/roslib/importmap.js"></script>

    <script type="module">
      import * as ROSLIB from "roslib";
      // Connecting to ROS
      // -----------------
      var ros = new ROSLIB.Ros();

      // If there is an error on the backend, an 'error' emit will be emitted.
      ros.on("error", function (error) {
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("error").style.display = "inline";
        console.log(error);
      });

      // Find out exactly when we made a connection.
      ros.on("connection", function () {
        console.log("Connection made!");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("error").style.display = "none";
        document.getElementById("closed").style.display = "none";
        document.getElementById("connected").style.display = "inline";
      });

      ros.on("close", function () {
        console.log("Connection closed.");
        document.getElementById("connecting").style.display = "none";
        document.getElementById("connected").style.display = "none";
        document.getElementById("closed").style.display = "inline";
      });

      // Create a connection to the rosbridge WebSocket server.
      ros.connect("ws://localhost:9090");

      // Calling a service
      // -----------------

      // First, we create a Service client with details of the service's name and service type.
      var addTwoIntsClient = new ROSLIB.Service({
        ros: ros,
        name: "/add_two_ints",
        serviceType: "example_interfaces/srv/AddTwoInts",
      });

      // Then we create a Service Request. The object we pass in to ROSLIB.ServiceRequest matches the
      // fields defined in the rospy_tutorials AddTwoInts.srv file.
      var request = {
        a: 1,
        b: 2,
      };

      // Finally, we call the /add_two_ints service and get back the results in the callback. The result
      // is a ROSLIB.ServiceResponse object.
      addTwoIntsClient.callService(request, function (result) {
        console.log(
          "Result for service call on " +
            addTwoIntsClient.name +
            ": " +
            result.sum,
        );
      });

      // Advertising a Service
      // ---------------------

      // The Service object does double duty for both calling and advertising services
      var setBoolServer = new ROSLIB.Service({
        ros: ros,
        name: "/set_bool",
        serviceType: "std_srvs/SetBool",
      });

      // Use the advertise() method to indicate that we want to provide this service
      setBoolServer.advertise(function (request, response) {
        console.log(
          "Received service request on " +
            setBoolServer.name +
            ": " +
            request.data,
        );
        response["success"] = true;
        response["message"] = "Set successfully";
        return true;
      });
    </script>
  </head>

  <body>
    <h1>Add Two Ints Service Example</h1>
    <p>
      Run the following commands in the terminal then refresh this page. Check
      the JavaScript console for the output.
    </p>
    <ol>
      <li><tt>ros2 run demo_nodes_py add_two_ints_server</tt></li>
      <li>
        <tt>ros2 launch rosbridge_server rosbridge_websocket_launch.xml</tt>
      </li>
    </ol>
    <div id="statusIndicator">
      <p id="connecting">Connecting to rosbridge...</p>
      <p id="connected" style="color: #00d600; display: none">Connected</p>
      <p id="error" style="color: #ff0000; display: none">
        Error in the backend!
      </p>
      <p id="closed" style="display: none">Connection closed.</p>
    </div>
  </body>
</html>
